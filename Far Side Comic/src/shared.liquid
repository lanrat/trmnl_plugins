<!-- Generated by _generator/generate.py -- DO NOT EDIT DIRECTLY -->
<style>
  .view {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  .image-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 10px;
    overflow: hidden;
    min-height: 0; /* Important for flex children */
  }

  .image-container img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    display: block;
    border-radius: 5px;
  }

  .title_bar {
    flex-shrink: 0;
    z-index: 1;
  }

  .text--center {
        text-align: center;
  }

  .caption-container {
        width: 100%;
        display: flex;
        justify-content: center;
  }
</style>

<script>
  /**
 * Parses an HTML string and returns the 'src' attribute of the first <img> tag found.
 *
 * @param {string} htmlString The HTML string to parse.
 * @returns {string | null} The URL from the image's 'src' attribute, or null if no <img> tag is found.
 */
  function getImageUrlFromString(htmlString) {
    try {
      // 1. Create a new DOMParser
      const parser = new DOMParser();

      // 2. Parse the HTML string into a document
      // 'text/html' tells the parser to treat it as HTML
      const doc = parser.parseFromString(htmlString, 'text/html');

      // 3. Find the first <img> element in the parsed document
      const img = doc.querySelector('img');

      // 4. If an <img> tag is found, return its 'src' attribute.
      //    Otherwise, return null.
      if (img) {
        return img.getAttribute('src');
      } else {
        console.warn("No <img> tag found in the provided string.");
        return null;
      }
    } catch (error) {
      console.error("Error parsing HTML string:", error);
      return null;
    }
  }

  function getEmTextFromString(htmlString) {
    try {
      // 1. Create a new DOMParser
      const parser = new DOMParser();

      // 2. Parse the HTML string into a document
      // 'text/html' tells the parser to treat it as HTML
      const doc = parser.parseFromString(htmlString, 'text/html');

      // 3. Find the first <em> element in the parsed document
      const em = doc.querySelector("p[style*='italic']");

      // 4. If an <em> tag is found, return its 'innerText' attribute.
      //    Otherwise, return null.
      if (em) {
        return em.textContent;
      } else {
        console.warn("No <em> tag found in the provided string.");
        return null;
      }
    } catch (error) {
      console.error("Error parsing HTML string:", error);
      return null;
    }
  }

  function displayImg(htmlString) {
    const imgElement = document.getElementById('comic-image');
    const txtElement = document.getElementById('caption');
    const newUrl = getImageUrlFromString(htmlString);
    if (newUrl) {
      imgElement.src = newUrl;
      txtElement.innerText =  getEmTextFromString(htmlString);
    } else {
      imgElement.alt = "Could not load comic.";
      console.error("Could not extract image URL.");
    }
  }


</script>

{% template comic %}
<div class="view bg-white">
  <div class="image-container">
    {% if item %}
    <img id="comic-image" class="image image-dither image--dither"/>
    {% else %}
    <p class="text--black">Error Loading Image</p>
    {% endif %}
  </div>
  <div class="caption-container">
    <p id="caption" class="value value--xsmall caption text--center" data-pixel-perfect="true">
  </div>
  {% if item %}
  <script>displayImg({{ item.description | json }});</script>
  {% endif %}
</div>
{% endtemplate %}